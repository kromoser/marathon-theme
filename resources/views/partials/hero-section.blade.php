@php($progress = HomeTemplate::getTotalDonations(get_the_ID()))

<section class="hero-section section container">
  <div class="columns">
    <div class="column hero-section-stats is-7-desktop is-6-tablet">
      <h1 class="hero-title">Miles to&nbsp;Go</h1>
      <p class="hero-subtitle">Running the 2019 NYC Marathon to raise money for Housing Works</p>
      <p class="stat-header">The Race</p>
      <h3 class="stat-highlight">26.2 <span class="stat-secondary">miles</span></h3>
      <p class="stat-header">The Goal</p>
      <h3 class="stat-highlight">$<span id="progress-total">{{$progress}}</span><span class="stat-secondary">/$2,500</span></h3>
      <p class="stat-header">The Training</p>
      <h3 class="stat-highlight"><span id="total-miles-logged">{!! HomeTemplate::sumMiles() !!}</span> <span class="stat-secondary">miles logged</span></h3>



    </div>

    <div class="column is-5-desktop is-6-tablet">
      <div class="progress-line-container">
        @php($progress = 3250 - $progress)



        <script type="text/javascript">
          document.addEventListener('DOMContentLoaded', function() {

            const progressPath = document.querySelector('.progress-line');
            const progressPathLength = progressPath.getTotalLength();
            const progressVal = parseInt({{$progress}});
            const totalDonations = progressPathLength - progressVal;

            console.log(progressPathLength);
            console.log({{$progress}})

          //  progressPath.style.strokeDasharray = (progressVal/2500)*progressPathLength;
          //  progressPath.style.strokeDashOffset = (progressVal/2500)*progressPathLength;

          // Draw SVG label
          const progPoint = progressPath.getPointAtLength(progressPath.getTotalLength()-progressVal);
          const svgGroup = document.createElementNS("http://www.w3.org/2000/svg", 'g');
          const textLabel = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
          const textNode = document.createElementNS("http://www.w3.org/2000/svg", 'text');
          const polygon = document.createElementNS("http://www.w3.org/2000/svg", 'polygon');

          const svg = document.getElementById('progress-map')


          polygon.setAttribute('style', 'fill: rgb(0,0,0); stroke-width: 4px; stroke: #595758');
          polygon.setAttribute('points',`${progPoint.x+30},${progPoint.y} ${progPoint.x+70},${progPoint.y-50} ${progPoint.x+660},${progPoint.y-50} ${progPoint.x+660},${progPoint.y+50} ${progPoint.x+70}, ${progPoint.y+50}`);

          textNode.setAttribute('x',progPoint.x + 90);
          textNode.setAttribute('y',progPoint.y + 15);
          textNode.setAttribute('style', 'fill: #f7d13b; font-size: 3rem; font-weight: bold; letter-spacing: .1rem')

          textNode.textContent = `$${totalDonations.toFixed()}/$2,500`;

          svgGroup.classList = 'fade-out';

          progressPath.addEventListener('animationend', function() {
            svgGroup.appendChild(polygon);
            svgGroup.appendChild(textNode)
            svg.appendChild(svgGroup);
            svgGroup.classList = 'fade-out'
            svgGroup.classList = 'fade-in';

          }, false);

          console.log(progPoint.x)
          console.log(progPoint.y)
          })
        </script>
        <svg version="1.1" id="progress-map" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  	 viewBox="0 0 2712.99 3029.27" style="enable-background:new 0 0 2712.99 3029.27;" xml:space="preserve">
  <style type="text/css">

  .fade-in {
    opacity: 1;
    transition: all .3s;
  }

  .fade-out {
    opacity: 0;
    transition: all .3s;
  }

  g {
    transition: all .3s;
  }

  @keyframes draw-line {
    from {
      stroke-dashoffset: 3250 ;
    }
    to {
      stroke-dashoffset: {{$progress}};
    }
  }
  </style>
  {{-- These paths are the background map outline --}}
  <g id="dark_map_bg">
    <path class="map-bg" d="M525.64,177.57c0,0,0,0,20.19-2.13c20.19-2.13,78.19,7.54,69.63,7.54s-29.94,21.38-40.63,27.8
  		c-10.69,6.41-21.38-12.83-44.37-12.83c-22.99,0-9.08,14.97,0,53.46c9.08,38.49,5.93,46.02,5.93,98.73s5.02,134.29,11.3,145.58
  		s24.57,101.66,24.57,101.66s-1.67,43.42,0.21,90.36c1.88,46.94,2.3,153.17,0.32,175.7c-1.98,22.53,5.65,161.89,10.2,190.99
  		s4.54,85.43,5.48,100.45c0.94,15.02,3.29,94.82-4.46,117.35c-7.75,22.53-0.24,89.19,28.87,141.76
  		c29.1,52.57,71.35,165.23,76.04,178.37c4.69,13.14,37.55,142.7,45.06,149.27s32.86,26.29,48.82,0
  		c15.96-26.29,38.49-88.25,68.53-111.72c30.04-23.47,77.92-37.55,78.86-63.84s-15.02-97.63-25.35-121.1s-45.06-41.31-51.63-63.84
  		s-26.29-73.23-16.9-141.76c9.39-68.53,16.9-157.72,16.9-180.25s20.5-61.02,12.59-76.04c-7.9-15.02-44.51-38.49-34.19-69.47
  		c10.33-30.98,4.69-26.29,5.63-59.14s26.29-47.88,4.69-83.55c-21.59-35.67-55.39-42.25-65.72-54.45
  		c-10.33-12.2-47.88-89.54-47.88-89.54h13.43c0,0,29.87,70.3,50.66,83.28c20.78,12.99,37.02,12.99,40.26,20.78
  		c3.25,7.79,11.04,3.25,25.33,0c14.29-3.25,42.21,6.66,67.54,4.3c25.33-2.35,32.47-8.85,32.47-40.67c0-31.82,5.2-35.15,10.39-45.5
  		c5.2-10.35,16.24-22.2,16.24-22.2c10.57-13.03,20.18-15.85,29.84-15.85c9.66,0,39.22,9.56,44.53,9.56c5.31,0,21.25-17,28.69-19.13
  		c7.44-2.13,34,5.31,44.63-24.44c10.63-29.75-2.13-48.88-28.69-65.88c-26.56-17-11.69-24.44-5.31-21.25s20.19,8.5,39.31,5.31
  		c19.13-3.19,46.75,14.88,64.81,21.25c18.06,6.38,49.94-35.06,49.94-35.06s-6.38-9.56-22.31-18.06c-15.94-8.5-3.19-25.5,1.06-37.19
  		c4.25-11.69,27.63-22.31,34-12.75c6.38,9.56,31.88,32.94,59.5,27.63s5.31-26.56,1.06-34c-4.25-7.44,0-21.25,23.38-45.69
  		c23.38-24.44,75.44-44.63,110.5-41.44c35.06,3.19,17.98-17,17.98-17s-20.11-6.38-27.55-12.75c-7.44-6.38,17-6.38,24.46-9.56
  		s-1.08-20.19-0.02-31.88c1.06-11.69-37.19,0-56.31-6.38c-19.13-6.38-27.63-29.75-38.25-27.63c-10.63,2.13-24.44,19.13-24.44,19.13
  		l-8.5-29.75c0,0-34-31.88-53.13-53.13c-19.13-21.25-38.25-62.69-38.25-68c0-5.31-10.63-22.31-23.38-26.56
  		c-12.75-4.25-7.44-27.63-7.44-27.63l19.13-8.5c0,0-3.05-9.13-9.78-20.31h-47.49c-0.38,0.63-0.77,1.06-1.17,1.19
  		c-2.62,0.87-13.88,4.62-16.59-1.19H490.99c2.18,7.82,4.2,15.08,5.96,21.38C509.7,67.07,525.64,177.57,525.64,177.57z"/>
  	<path class="map-bg" d="M865.8,2552.2c-25.23-11.06-25.32-20.54-72.72-34.76s-83.73-75.83-101.11-131.12s-48.97-47.39-88.47-33.18
  		c-39.49,14.22-73.05,66.35-73.05,66.35l-40.49,16.27c0,0-40.26,30.96-53.53,55.28c-13.27,24.33-44.23,44.23-44.23,44.23l-57.5,19.9
  		c0,0-72.98,66.34-77.4,81.82c-4.42,15.48-61.92,22.11-77.4,23.59c-15.48,1.47-57.5,0.74-79.61,0.93
  		c-22.11,0.19-55.28,35.19-57.5,48.46c-2.21,13.27-22.11,121.63-19.9,130.47c2.21,8.85,55.28,95.09,55.28,95.09
  		s26.54-4.42,44.23,4.42c17.69,8.85-8.85,33.17,17.69,61.92c6.47,7.01,11.5,16.53,15.36,27.39h712.45
  		c33.16-117.49,84.71-368.07,84.71-368.07s0,0,3.16-15.8s0-20.54,0-42.65S891.03,2563.26,865.8,2552.2z"/>
  	<path class="map-bg" d="M1631.91,2404.64c-38.61,19.3-42.47,9.01-23.16-6.43c19.3-15.44,198.19-102.95,191.75-106.81
  		c-6.43-3.86-7.72-29.6-7.72-29.6l63.06-42.47l36.03,27.03l32.17,33.46c0,0,51.48-46.33,63.06-56.62
  		c11.58-10.3,10.3-51.48-7.72-60.49s-104.24-111.96-122.26-117.11s-81.08-30.89-106.81-50.19c-25.74-19.3,6.43-97.81,23.16-176.31
  		s115.82-169.87,160.87-209.77c45.04-39.89,132.55-74.64,157.01-74.64s234.22,14.16,234.22,14.16s0,34.75,0,52.76
  		s-27.03,34.75-30.89,34.75s10.3,99.09,10.3,99.09s29.6-12.87,41.18-16.73c11.58-3.86,13.67-50.99,13.67-50.99l-13.19-33.22
  		l6.6-79.38l82.44,26.38l-13.07-76.13c0,0,59.88-87.4,63.93-97.11c4.05-9.71,8.09-19.42,8.09-19.42s18.61-22.66,18.61-29.13
  		c0-6.47-23.47-43.7-27.51-49.36c-4.05-5.66-13.76-11.33-13.76-11.33v-24.28l18.61,3.24c0,0,37.23-39.65,48.55-51.79
  		s3.24-21.85-4.05-37.23c-7.28-15.38-38.03-38.84-44.51-42.08c-6.47-3.24-13.76-29.94-29.13-56.65
  		c-15.38-26.71-18.61-52.6-21.85-64.74c-3.24-12.14-46.94-87.4-63.93-111.68c-16.99-24.28-15.38-38.03-25.9-58.27
  		s-106.01-126.24-112.49-136.76c-6.47-10.52,98.73-110.06,98.73-110.06s0-3.24,0-8.9s-16.99-89.83-18.61-103.58
  		s-50.98-85.78-50.98-85.78s-51.79-8.9-82.54-16.18c-30.75-7.28-241.96-41.27-252.48-41.27c-10.52,0-13.53,8.09-13.53,8.09
  		l-39.88-16.99c0,0-8.09,4.05-8.09,28.32c0,24.28,20.23,42.08,28.32,48.55c8.09,6.47-0.81,22.66-0.81,22.66s25.9,27.51,19.42,30.75
  		c-6.47,3.24-28.32,0.81-35.61-1.62s-49.36-19.42-63.93-35.61s-83.35-46.94-90.64-52.6c-7.28-5.66,23.47-15.38-18.61-44.51
  		c-42.08-29.13-57.46,12.14-49.36,17.8c8.09,5.66,9.71,17.8,0,33.13c-9.71,15.33-21.85,15.43-26.71,16.23s-14.57,19.42-14.57,19.42
  		s0,0-5.66-1.62s-16.99-28.32-23.47-33.18c-6.47-4.86-55.03,12.14-67.17,19.42c-12.14,7.28-31.56,17.8-65.55,18.61
  		s-41.27,14.57-46.13,29.13c-4.86,14.57-16.19,29.13-11.33,35.61c4.86,6.47,8.9,17.8,0.81,52.6s-42.08-18.61-59.07-29.94
  		c-16.99-11.33-49.36,48.55-49.36,53.41s-25.9,0-25.9,0s16.99,32.37,16.99,37.23s-12.95,52.6-12.95,52.6s32.37,10.52,35.61,10.52
  		s32.37-21.9,32.37-21.9s42.89,78.54,61.5,96.35s45.32,13.76,45.32,13.76s-16.99,46.13-16.99,56.65s-43.7,11.33-64.74,10.52
  		c-21.04-0.81-21.04-26.71-17.8-28.32c3.24-1.62,1.62-32.37-1.62-32.37c-3.24,0,4.86-21.85,4.86-21.85s-109.25-5.66-121.39-5.66
  		s-5.66-29.94-5.66-33.18s-18.92-7.28-18.92-7.28l-3,53.47c0,0-45.64,18.78-40.95,26.29c4.69,7.51,33.8,34.74,29.1,42.25
  		c-4.69,7.51-39.35,19.71-49.72,0c-10.37-19.71-26.33-32.86-34.77-32.86c-8.45,0-28.16-26.29-40.37-26.29
  		c-12.2,0-78.86-16.9-90.12,46s-32.78,135.19-44.08,132.37c-11.31-2.82-42.29-2.82-34.77,27.22c7.51,30.04,23.47,15.02,27.22,26.29
  		c3.76,11.27-10.33,36.61-17.84,58.21s-0.88,66.65-5.6,106.08c-4.72,39.43,4.72,77.92,0,110.78c-4.72,32.86,7.48,63.84,22.5,40.37
  		c15.02-23.47,29.1-37.55,78.86-32.86c49.76,4.69,29.46-3.76,47.12,12.2c17.66,15.96,39.25,18.78,55.21,13.14
  		c15.96-5.63,45.06-10.33,61.96,5.63c16.9,15.96,30.98,33.8,30.98,33.8s0,14.08-12.2,4.69c-12.2-9.39-25.35-28.16-32.86-33.8
  		c-7.51-5.63-14.08-11.27-39.43-2.82c-25.35,8.45-67.59-8.45-77.92-16.9s-82.53-23.47-103.23,27.22s16.86,55.39,23.43,71.35
  		s16.9,27.22,15.02,46.94s-6.57,47.88,0,70.41s21.59,53.51,27.22,68.53c5.63,15.02,10.33,41.31,0.94,49.76
  		c-9.39,8.45-29.1,9.39-37.55,0c-8.45-9.39-27.22-9.63-46.94,9.27c-19.71,18.89-37.71,18.89-46.55,37.67
  		c-8.84,18.78,6.18,38.77,4.3,82.76c-1.88,43.98,12.2,72.15,1.88,86.23c-10.33,14.08-50.69,76.98-43.18,87.31
  		c7.51,10.33,34.74,39.43,55.39,43.18c20.65,3.76,51.63,2.82,63.84,0c12.2-2.82,17.84,4.69,19.71-5.63s12.2-15.96,9.39-25.35
  		c-2.82-9.39-14.08-52.57-6.57-61.02c7.51-8.45,24.41-6.57,27.22-14.08c2.82-7.51,6.05-18.65,3.16-25.51s-0.62-4.11,0.42-1.73
  		s4.02,12.5-0.3,22.31c-4.31,9.82-4.91,9.07-15.62,13.54c-10.71,4.46-13.83,3.57-15.17,8.78c-1.34,5.21,2.23,33.32,4.46,41.35
  		c2.23,8.03,7.88,19.19,1.79,30.2c-6.1,11.01-3.12,17.55,1.04,18.59c4.17,1.04,20.95,4.82,20.95,4.82s-19.63,15.7-29.44,32.71
  		c-9.81,17.01-34.02,57.58-39.26,102.07c-5.23,44.49-11.93,80.91-21.4,101.44c-9.48,20.54-44.83,120.06,21.82,200.63
  		c66.65,80.57,88.77,90.05,118.78,88.47c30.02-1.58,58.94-12.6,82.15-18.96c27.59-7.56,66.2-11.42,66.2-11.42l29.6,2.57
  		c0,0,83.65,32.17,114.54,38.61c30.89,6.43,46.33,52.76,46.33,52.76s-30.89,7.72-90.08,21.88c-59.2,14.16-5.15,68.21,3.86,70.78
  		c9.01,2.57,60.49,0,60.49,0s18.02-10.3,78.5-51.48c60.49-41.18,289.56-202.05,289.56-202.05l-27.03-37.32
  		C1700.12,2368.6,1670.52,2385.33,1631.91,2404.64z"/>
  	<path class="map-bg" d="M2667.71,1601.13c-24.91-11.32-40.76-20.38-54.34-27.17c-13.59-6.79-48.9,4.53-68.61,27.17
  		s-53.67,11.32-69.52,13.59c-15.85,2.26-38.49,11.36-24.91,32.85c0,0,20.38-12.43,27.17,0c6.79,12.43,15.85,41.87,22.64,53.19
  		s18.11,38.49,18.11,38.49l-33.96,33.96c0,0-11.32-51.92-18.11-65.59c-6.79-13.66-40.76-36.31-43.02,11.24
  		c-2.26,47.55-2.26,63.4-36.23,92.84c-33.96,29.44-52.08,67.93-67.93,106.42c-15.85,38.49-76.99,138.12-115.48,160.76
  		c-38.49,22.64-67.93,40.76-95.1,110.95c-27.17,70.19-76.99,113.21-110.95,131.33c-33.96,18.11-24.91,52.08-47.55,72.46
  		c-22.64,20.38-67.93,22.64-67.93,22.64s-58.87,55.95-74.72,85.71c-15.85,29.76-52.08,81.84-40.76,97.69
  		c11.32,15.85,36.23,47.12,36.23,60.92s92.84-129.51,122.27-158.61c29.44-29.11,86.04-94.61,135.86-159.22
  		c49.81-64.61,194.73-252.54,228.69-295.57c33.96-43.02,153.97-167.56,192.46-196.99c38.49-29.44,131.33-93.19,149.44-95.28
  		c18.11-2.09,33.96-60.96,33.96-60.96l47.55-26.25C2712.99,1667.71,2692.61,1612.45,2667.71,1601.13z"/>
  	<path class="map-bg" d="M2079.1,1634.49l-57.65,13.07c0,0,52.64,66.74,52.64,79.28s5.01,100.27,22.56,97.76
  		c17.55-2.51,42.61-35.09,67.68-27.57s35.09-7.41,40.11,27.63c5.01,35.04,20.05,112.75,20.05,112.75l32.59-20.05l-18.39-67.68
  		v-40.11L2079.1,1634.49z"/>

</g>
<g id="SVG">
  <path class="route-line" d="M908,2616.65l119.27-150.59v-59.29l-24.85-2.18l-32.26-147.35l44.9-271.6l12.21-127.74l-3.49-76.29l-14.82-9.59
	l125.99-96.78l-61.47-74.55l-64.09-24.85l-11.77-28.34l-2.18-35.75l19.18-102.45l-43.6-34.44l14.39-11.33l-37.93-47.96l-13.95-48.83
	l-15.69,3.92l-9.85-37.93l9.41-7.41l45.78-14.39v-30.95H807.11V735.31l19.18-35.75l-1.31-22.23l-17.87,1.74l-1.74-21.36
	l-51.01-11.77l-13.08,11.33h-20.93v92.42h-13.51v26.59h13.95v228.88l-19.18,8.28c0,0-1.74,22.67-3.49,27.9s-2.62,12.21,0,17
	c2.62,4.8,11.77,8.72,8.28,14.39c-3.49,5.67-8.72,13.95-4.36,19.18c4.36,5.23,10.03,15.26,7.85,24.85s-15.07,25.72-13.42,27.47
	c1.65,1.74,18.65,16.57,18.65,16.57v17.87h-60.6c0,0-1.74-15.69,3.92-33.13c5.67-17.44,7.85-26.16,7.85-27.03s0,0.87,0,0.87"/>
  {{--
  <circle class="" style="fill: #5b5b5b" cx="666.04" cy="1118.31" r="28.04"/>
  --}}
</g>
<g id="progress">
  <path class="progress-line" d="M908,2616.65l119.27-150.59v-59.29l-24.85-2.18l-32.26-147.35l44.9-271.6l12.21-127.74l-3.49-76.29l-14.82-9.59
	l125.99-96.78l-61.47-74.55l-64.09-24.85l-11.77-28.34l-2.18-35.75l19.18-102.45l-43.6-34.44l14.39-11.33l-37.93-47.96l-13.95-48.83
	l-15.69,3.92l-9.85-37.93l9.41-7.41l45.78-14.39v-30.95H807.11V735.31l19.18-35.75l-1.31-22.23l-17.87,1.74l-1.74-21.36
	l-51.01-11.77l-13.08,11.33h-20.93v92.42h-13.51v26.59h13.95v228.88l-19.18,8.28c0,0-1.74,22.67-3.49,27.9s-2.62,12.21,0,17
	c2.62,4.8,11.77,8.72,8.28,14.39c-3.49,5.67-8.72,13.95-4.36,19.18c4.36,5.23,10.03,15.26,7.85,24.85s-15.07,25.72-13.42,27.47
	c1.65,1.74,18.65,16.57,18.65,16.57v17.87h-60.6c0,0-1.74-15.69,3.92-33.13c5.67-17.44,7.85-26.16,7.85-27.03s0,0.87,0,0.87"/>
  <circle class="progress-line"  cx="907.91" cy="2616.78" r="28.04"/>

</g>


  {{-- This is the full route line --}}
{{--   <path class="route-line" d="M308.8,1992.9L428,1842.3V1783l-24.8-2.2l-32.3-147.4l44.9-271.6l12.2-127.7l-3.5-76.3l-14.8-9.6l126-96.8
    l-61.5-74.5l-64.1-24.8l-11.8-28.3l-2.2-35.7l19.2-102.5l-43.6-34.4l14.4-11.3l-37.9-48l-14-48.8l-15.7,3.9l-9.8-37.9l9.4-7.4
    l45.8-14.4v-31H207.9V111.6l19.2-35.7l-1.3-22.2l-17.9,1.7L206.1,34l-51-11.8l-13.1,11.3h-20.9V126h-13.5v26.6h14v228.9l-19.2,8.3
    c0,0-1.7,22.7-3.5,27.9c-1.7,5.2-2.6,12.2,0,17s11.8,8.7,8.3,14.4c-3.5,5.7-8.7,14-4.4,19.2c4.4,5.2,10,15.3,7.8,24.8
    c-2.2,9.6-15.1,25.7-13.4,27.5c1.7,1.7,18.7,16.6,18.7,16.6v17.9H55.3c0,0-1.7-15.7,3.9-33.1c5.7-17.4,7.8-26.2,7.8-27s0,0.9,0,0.9"
    />

  <path class="progress-line" d="M308.8,1992.9L428,1842.3V1783l-24.8-2.2l-32.3-147.4l44.9-271.6l12.2-127.7l-3.5-76.3l-14.8-9.6l126-96.8
  	l-61.5-74.5l-64.1-24.8l-11.8-28.3l-2.2-35.7l19.2-102.5l-43.6-34.4l14.4-11.3l-37.9-48l-14-48.8l-15.7,3.9l-9.8-37.9l9.4-7.4
  	l45.8-14.4v-31H207.9V111.6l19.2-35.7l-1.3-22.2l-17.9,1.7L206.1,34l-51-11.8l-13.1,11.3h-20.9V126h-13.5v26.6h14v228.9l-19.2,8.3
  	c0,0-1.7,22.7-3.5,27.9c-1.7,5.2-2.6,12.2,0,17s11.8,8.7,8.3,14.4c-3.5,5.7-8.7,14-4.4,19.2c4.4,5.2,10,15.3,7.8,24.8
  	c-2.2,9.6-15.1,25.7-13.4,27.5c1.7,1.7,18.7,16.6,18.7,16.6v17.9H55.3c0,0-1.7-15.7,3.9-33.1c5.7-17.4,7.8-26.2,7.8-27s0,0.9,0,0.9"
  	/> --}}


  </svg>
      </div>
    </div>
  </div>
</section>
